{% extends 'base.html' %}
{% block title %}Comparison Result{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="mb-10 text-center">
        <h1 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-slate-100 sm:text-4xl">Comparison Analysis</h1>
        <p class="mt-3 text-lg text-slate-600 dark:text-slate-400">An AI-generated analysis of the selected papers.</p>
    </div>

    <!-- Main content container -->
    <div class="space-y-8">

        <!-- Papers Compared Section -->
        <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-6 ring-1 ring-slate-200 dark:ring-slate-700">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Papers Compared</h2>
            <ul class="mt-4 space-y-2 list-disc list-inside text-slate-600 dark:text-slate-300">
                {% for paper in comparison.papers.all %}
                <li>{{ paper.title }}</li>
                {% empty %}
                <li>No papers were selected for comparison.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- AI Analysis Section -->
        <div class="bg-white dark:bg-slate-900/70 rounded-lg p-6 sm:p-8 ring-1 ring-slate-900/5 dark:ring-white/10">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">AI-Generated Analysis</h2>
            <!-- The 'prose' classes from Tailwind will style the rendered markdown -->
            <div id="markdown-container" class="prose prose-slate dark:prose-invert max-w-none">
                <!-- Content will be rendered here by JavaScript -->
            </div>
        </div>

    </div>

    <!-- Back Button -->
    <div class="mt-12 text-center">
        <a href="{% url 'dashboard' %}" class="inline-flex items-center gap-x-2 rounded-md bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" aria-hidden="true">
                <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
            </svg>
            Back to Dashboard
        </a>
    </div>

</div>
{% endblock %}


{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{{ comparison.comparison_result|json_script:"markdown-data" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const rawMarkdown = JSON.parse(document.getElementById('markdown-data').textContent);
    const container = document.getElementById('markdown-container');

    if (rawMarkdown && container) {
        // Render Markdown with GitHub Flavored Markdown and line breaks enabled
        container.innerHTML = marked.parse(rawMarkdown, { gfm: true, breaks: true });
    } else if (container) {
        container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No analysis data was found for this comparison.</p>';
    }
});
</script>
{% endblock %}
